<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Sistem Informasi SSJ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="flex items-center justify-center min-h-screen">
        <div class="w-full max-w-md p-8 space-y-8 bg-white rounded-lg shadow-md">
            <div>
                <img class="w-auto h-12 mx-auto" src="https://placehold.co/150x50/e2e8f0/334155?text=Logo+SSJ" alt="Logo SSJ">
                <h2 class="mt-6 text-3xl font-extrabold text-center text-gray-900">
                    Masuk ke akun Anda
                </h2>
            </div>
            <form id="login-form" class="mt-8 space-y-6">
                <div class="rounded-md shadow-sm -space-y-px">
                    <div>
                        <label for="username" class="sr-only">Username</label>
                        <input id="username" name="username" type="text" required class="relative block w-full px-3 py-2 text-gray-900 placeholder-gray-500 border border-gray-300 rounded-none appearance-none rounded-t-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm" placeholder="Username">
                    </div>
                    <div>
                        <label for="password" class="sr-only">Password</label>
                        <input id="password" name="password" type="password" required class="relative block w-full px-3 py-2 text-gray-900 placeholder-gray-500 border border-gray-300 rounded-none appearance-none rounded-b-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm" placeholder="Password">
                    </div>
                </div>

                <div>
                    <button type="submit" id="login-button" class="relative flex justify-center w-full px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md group hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                            <!-- Heroicon name: solid/lock-closed -->
                            <svg class="w-5 h-5 text-blue-500 group-hover:text-blue-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" />
                            </svg>
                        </span>
                        Masuk
                    </button>
                </div>
            </form>
            <div id="error-message" class="hidden p-4 mt-4 text-sm text-red-700 bg-red-100 rounded-lg" role="alert">
                <!-- Pesan error akan ditampilkan di sini -->
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- KONFIGURASI PENTING ---
            // Ganti dengan URL Web App Anda yang sudah di-deploy
            const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzcjowpZK5bRM2g5VQ77iG3KmYP6ff9u2eV8CJQOxwB3LuxeBOYHEXrcY738IQ3AVmC/exec';

            const loginForm = document.getElementById('login-form');
            const loginButton = document.getElementById('login-button');
            const errorMessageDiv = document.getElementById('error-message');

            loginForm.addEventListener('submit', async function (e) {
                e.preventDefault(); // Mencegah form mengirim data secara tradisional

                // Tampilkan status loading
                loginButton.disabled = true;
                loginButton.textContent = 'Memproses...';
                errorMessageDiv.classList.add('hidden');

                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                // Data yang akan dikirim ke Google Apps Script
                const requestData = {
                    action: 'handleLogin',
                    username: username,
                    password: password
                };

                try {
                    const response = await fetch(WEB_APP_URL, {
                        method: 'POST',
                        // Redirect 'follow' diperlukan untuk menangani CORS
                        redirect: 'follow',
                        body: JSON.stringify(requestData),
                        headers: {
                            'Content-Type': 'text/plain;charset=utf-8',
                        }
                    });

                    const result = await response.json();

                    if (result.status === 'success') {
                        // Jika login berhasil, simpan data pengguna dan arahkan ke dashboard
                        alert(result.message);
                        // Menyimpan data pengguna di localStorage untuk digunakan di halaman lain
                        localStorage.setItem('userData', JSON.stringify(result.userData));
                        window.location.href = 'index.html'; // Ganti dengan nama file dashboard Anda
                    } else {
                        // Jika gagal, tampilkan pesan error
                        errorMessageDiv.textContent = result.message;
                        errorMessageDiv.classList.remove('hidden');
                    }

                } catch (error) {
                    console.error('Error saat login:', error);
                    errorMessageDiv.textContent = 'Terjadi kesalahan. Silakan coba lagi.';
                    errorMessageDiv.classList.remove('hidden');
                } finally {
                    // Kembalikan tombol ke keadaan normal
                    loginButton.disabled = false;
                    loginButton.textContent = 'Masuk';
                }
            });
        });
    </script>

</body>
</html>
